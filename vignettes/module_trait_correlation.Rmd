---
title: "Module Trait Correlation"
output: rmarkdown::html_vignette
description: >
  Tutorial for identifying relationships between scWGCNA modules with biological and technical variables.
vignette: >
  %\VignetteIndexEntry{Module Trait Correlation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


Load the snRNA-seq data and the required libraries:
```{r eval=FALSE}

# single-cell analysis package
library(Seurat)

# plotting and data science packages
library(tidyverse)
library(cowplot)
library(patchwork)

# co-expression network analysis packages:
library(WGCNA)
library(scWGCNA)

# using the cowplot theme for ggplot
theme_set(theme_cowplot())

# load the Zhou et al snRNA-seq dataset
seurat_ref <- readRDS('data/Zhou_control.rds')

```

Compute module trait correlation split by cell type:

```{r eval=FALSE}

seurat_obj$Sample <- factor(as.character(seurat_obj$Sample), levels=unique(seurat_obj$Sample))
seurat_obj$msex <- as.factor(seurat_obj$msex)
seurat_obj$age_death <- as.numeric(seurat_obj$age_death)

cur_traits <- c('Sample', 'total_counts_mt', 'n_genes_by_counts', 'age_death', 'braaksc', 'msex')
data_types <- sapply(cur_traits, function(x){class(seurat_obj@meta.data[,x])})

# list of traits
cur_traits <- c('braaksc', 'pmi', 'msex', 'age_death', 'doublet_scores', 'nCount_RNA', 'nFeature_RNA', 'total_counts_mt')

seurat_obj <- ModuleTraitCorrelation(
  seurat_obj,
  traits = cur_traits,
  group.by='cell_type'
)


```

Plot the results as a heatmap for each cell type:

```{r eval=FALSE}

PlotModuleTraitCorrelation(
  seurat_obj,
  label = 'fdr',
  label_symbol = 'stars',
  text_size = 2,
  text_digits = 2,
  text_color = 'white',
  high_color = 'yellow',
  mid_color = 'black',
  low_color = 'purple',
  plot_max = 0.2,
  combine=TRUE
)


```

<img src="figures/mt_correlation/ME_Trait_correlation_fdr.png" width="600" height="600">
