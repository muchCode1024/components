---
title: "scWGCNA Basics"
output: rmarkdown::html_vignette
description: >
  Tutorial for applying the core functions of scWGCNA.
vignette: >
  %\VignetteIndexEntry{scWGCNA Basics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Load Zhou et al data into Seurat

![](figures/logo_v2.png)

<img src="figures/logo_v2.png" align="center" height="20%" width="20%" />

```{r eval=FALSE}

#knitr::include_graphics("man/figures/logo_v2.png")

# load R packages
library(Seurat)
library(tidyverse)
library(cowplot)
library(Matrix)
library(viridis)
library(harmony)
library(RColorBrewer)
library(patchwork)
library(ggpubr)
library(tictoc)
library(RColorBrewer)
library(Hmisc)
library(corrplot)
library(enrichR)
library(GeneOverlap)
library(WGCNA)
library(grid)
library(gridExtra)
enableWGCNAThreads(nThreads = 8)
theme_set(theme_cowplot())
set.seed(12345)


setwd('/dfs3b/swaruplab/smorabit/analysis/scWGCNA/')

# output directories
data_dir <- "data/"
fig_dir <- 'figures/'

# scp R/* hpc3:/dfs3b/swaruplab/smorabit/analysis/scWGCNA/bin/

scripts <- dir("bin/")
scripts <- scripts[scripts != 'scWGCNA.R']
for(script in scripts){
  source(paste0("bin/", script))
}

umap_theme <- theme(
  axis.line=element_blank(),
  axis.text.x=element_blank(),
  axis.text.y=element_blank(),
  axis.ticks=element_blank(),
  axis.title.x=element_blank(),
  axis.title.y=element_blank(),
  panel.background=element_blank(),
  panel.border=element_blank(),
  panel.grid.major=element_blank(),
  panel.grid.minor=element_blank(),
  plot.background=element_blank(),
  plot.title = element_text(hjust = 0.5)
)

# re-load scWGCNA dataset:
seurat_obj <- readRDS(file=paste0(data_dir, 'Zhou_control_scWGCNA.rds'))

# set annotation factor levels:
seurat_obj$annotation <- factor(
  as.character(seurat_obj$annotation),
  levels = c(
    "INH VIP+", "INH PVALB+", "INH SST+", "INH LAMP5+",
    "EX1", 'EX2', 'EX3', 'EX4', 'EX5', 'EX6', 'EX7', 'EX8', 'EX9', 'EX10', 'OPC', 'ODC1', 'ODC2', 'ODC3', 'ODC4',
    'ODC5', 'ODC6', 'ODC7', 'ODC8', 'ODC9',
    'ASC1', 'ASC2', 'ASC4', 'MG'
  )
)

seurat_obj$cell_type <- factor(
  as.character(seurat_obj$cell_type),
  levels = c('INH', 'EX', 'OPC', 'ODC', 'ASC', 'MG')
)


################################################################################
# make a color scheme for this dataset with MetBrewer:
################################################################################

library(MetBrewer)

n_groups <- length(levels(seurat_obj$annotation))

# INH + EX
cluster_colors1 = paste0(met.brewer("Signac", 14, type='discrete'))

# Glia
cluster_colors2 = paste0(met.brewer("Morgenstern", 8, type='continuous'))
cluster_colors3 = paste0(met.brewer("Lakota", 6, type='discrete'))

# combine
cluster_colors <- c(cluster_colors1, cluster_colors2, cluster_colors3)

names(cluster_colors) <- levels(seurat_obj$annotation)

celltype_colors <- cluster_colors[c('INH VIP+', 'EX4', 'OPC', 'ODC5', 'ASC1', 'MG')]
names(celltype_colors) <- levels(seurat_obj$cell_type)

save(cluster_colors, celltype_colors, file='data/Zhou_color_scheme.rda')

```
